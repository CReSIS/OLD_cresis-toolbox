function [] = save_result3D( data_matrix, data_type, algorithm, param_setup, method, data_used, best_parameter_set )
%SAVE_RESULT 
%   save the result from the grid/random test applied to the 3D data
%   Input:

%     data_matrix:  The data matrix from the test after we processed it from the cluster

%     algorithm:  A string to show what algorithm we've used -- Viterbi or
%     TRWS

%     param_setup: A structure to show what combination of parameters we
%     have -- for grid search, this is simply a structure for the grid
%             for random search, this is the range we've setup for each
%             parameter

%     method: A string to show this is 'grid search' or 'random search'

%     segments_and_frame: A structure to show what frames we have selected
%     from each segment



% NOTES for some variables:
% data_matrix:          result of the test tun in matrix form.

% param_setup:          the test setup -- for grid search, it's the 
%                       "grid" we ran upon; for random search, it's 
%                       the range specified for each parameter.

% data_used:            For 3D, it's a map where the keys are the
%                       segments and its values are the frames that 
%                       belong to that segment.

% search_result_table:  display the top 25 result from the search.

% best_parameter_table  display the result from fmincon.
  


  date_testsd = datestr(datetime('now'));
  
  
  [~,rank_indices] = sort(data_matrix(:,end-1), 'ascend'); % rank by mean error from low to high
  data_matrix = data_matrix(rank_indices,:);
  
  if strcmp(data_type, '3D') % in this block, we save the top 10 results from the grid/random search that we've carried out
    if strcmp(algorithm, 'Viterbi')
      info = {'smooth_weight', 'smooth_variance', 'repulsion',...
        'ice_dist_thr', 'egt_weight', 'percentage_correct', 'bin_5_pass_rate', ...
        'bin_10_pass_rate', 'bin_15_pass_rate', ...
        'bin_20_pass_rate', 'bin_25_pass_rate', ...
        'rmse', 'mean','median'};
      
      till = min(size(data_matrix,1), 25);
      search_result_table = table(data_matrix(1:till,1),data_matrix(1:till,2), data_matrix(1:till,3), ...
        data_matrix(1:till,4), data_matrix(1:till,5), data_matrix(1:till,6), ...
        data_matrix(1:till,7), data_matrix(1:till,8), ...
        data_matrix(1:till,9),  data_matrix(1:till,10) ,...
        data_matrix(1:till,11),  data_matrix(1:till,12),  data_matrix(1:till,13), ...
        data_matrix(1:till,14), ...
        'VariableNames',info);
      
      best_parameter_table = table(best_parameter_set(1,1),best_parameter_set(1,2), best_parameter_set(1,3), ...
        best_parameter_set(1,4), best_parameter_set(1,5), best_parameter_set(1,6), ...
        best_parameter_set(1,7), best_parameter_set(1,8), ...
        best_parameter_set(1,9),  best_parameter_set(1,10) ,...
        best_parameter_set(1,11),  best_parameter_set(1,12),  best_parameter_set(1,13), ...
        best_parameter_set(1,14), ...
        'VariableNames',info);
      
    elseif strcmp(algorithm, 'TRWS')
      info = {'correlation', 'smooth_1', 'smooth_2',...
        'smooth_3', 'percentage_correct', 'bin_5_pass_rate', ...
        'bin_10_pass_rate', 'bin_15_pass_rate', ...
        'bin_20_pass_rate', 'bin_25_pass_rate', ...
        'rmse', 'mean','median'};
      
      till = min(size(data_matrix,1), 25);
      search_result_table = table(data_matrix(1:till,1),data_matrix(1:till,2), data_matrix(1:till,3), ...
        data_matrix(1:till,4), data_matrix(1:till,5), data_matrix(1:till,6), ...
        data_matrix(1:till,7), data_matrix(1:till,8), ...
        data_matrix(1:till,9),  data_matrix(1:till,10) ,...
        data_matrix(1:till,11),  data_matrix(1:till,12),  data_matrix(1:till,13), ...
        'VariableNames',info);
      best_parameter_table = table(best_parameter_set(1,1),best_parameter_set(1,2), best_parameter_set(1,3), ...
        best_parameter_set(1,4), best_parameter_set(1,5), best_parameter_set(1,6), ...
        best_parameter_set(1,7), best_parameter_set(1,8), ...
        best_parameter_set(1,9),  best_parameter_set(1,10) ,...
        best_parameter_set(1,11),  best_parameter_set(1,12),  best_parameter_set(1,13), ...
        'VariableNames',info);
    end
  elseif strcmp(data_type, '2D')
    if strcmp(algorithm, 'Viterbi')
      info = {'smooth_weight', 'smooth_variance', 'repulsion',...
        'ice_dist_thr', 'percentage_correct', 'bin_5_pass_rate', ...
        'bin_10_pass_rate', 'bin_15_pass_rate', ...
        'bin_20_pass_rate', 'bin_25_pass_rate', ...
        'rmse', 'mean','median'};
      
      till = min(size(data_matrix,1), 25);
      search_result_table = table(data_matrix(1:till,1),data_matrix(1:till,2), data_matrix(1:till,3), ...
        data_matrix(1:till,4), data_matrix(1:till,5), data_matrix(1:till,6), ...
        data_matrix(1:till,7), data_matrix(1:till,8), ...
        data_matrix(1:till,9),  data_matrix(1:till,10) ,...
        data_matrix(1:till,11),  data_matrix(1:till,12),  data_matrix(1:till,13), ...
        'VariableNames',info);
      best_parameter_table = table(best_parameter_set(1,1),best_parameter_set(1,2), best_parameter_set(1,3), ...
        best_parameter_set(1,4), best_parameter_set(1,5), best_parameter_set(1,6), ...
        best_parameter_set(1,7), best_parameter_set(1,8), ...
        best_parameter_set(1,9),  best_parameter_set(1,10) ,...
        best_parameter_set(1,11),  best_parameter_set(1,12),  best_parameter_set(1,13), ...
        'VariableNames',info);
    elseif strcmp(algorithm, 'TRWS')
    end
  end % end of saving the search-result table  
  
  
  if strcmp(data_type, '3D')
    if strcmp(method, 'grid search')
      if strcmp(algorithm, 'Viterbi')
        save(strcat('../../../../tuning_results/grid_search_viterbi_3D/', method, '_', date_testsd), 'algorithm', ...
          'param_setup', 'data_matrix', 'data_type', ...
          'data_used', 'method', 'date_testsd', 'search_result_table','best_parameter_table');
      elseif strcmp(algorithm, 'TRWS')
        save(strcat('../../../../tuning_results/grid_search_trws_3D/', method, '_', date_testsd), 'algorithm', ...
          'param_setup', 'data_matrix', 'data_type', ...
          'data_used', 'method', 'date_testsd', 'search_result_table','best_parameter_table');
      end
    elseif strcmp(method, 'random search')
      if strcmp(algorithm, 'Viterbi')
        save(strcat('../../../../tuning_results/random_search_viterbi_3D/', method, '_', date_testsd), 'algorithm', ...
          'param_setup', 'data_matrix', 'data_type', ...
          'data_used', 'method', 'date_testsd', 'search_result_table','best_parameter_table');
      elseif strcmp(algorithm, 'TRWS')
        save(strcat('../../../../tuning_results/random_search_trws_3D/', method, '_', date_testsd), 'algorithm', ...
          'param_setup', 'data_matrix', 'data_type', ...
          'data_used', 'method', 'date_testsd', 'search_result_table','best_parameter_table');
      end
    end
  elseif strcmp(data_type, '2D')
    if strcmp(method, 'grid search')
      save(strcat('../../../../tuning_results/grid_search_viterbi_2D/', method, '_', date_testsd), 'algorithm', ...
        'param_setup', 'data_matrix', 'data_type', ...
        'data_used', 'method', 'date_testsd', 'search_result_table','best_parameter_table');
    elseif strcmp(method, 'random search')
      save(strcat('../../../../tuning_results/random_search_viterbi_2D/', method, '_', date_testsd), 'algorithm', ...
        'param_setup', 'data_matrix', 'data_type', ...
        'data_used', 'method', 'date_testsd', 'search_result_table','best_parameter_table');
    end
  end
%   
%   save(strcat('./RESULTS/', method, '_', date_testsd), 'algorithm', ...
%           'param_setup', 'data_matrix', 'data_type', ...
%           'data_used', 'method', 'date_testsd', 'search_result_table','best_parameter_table');
  
end

